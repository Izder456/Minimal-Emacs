<p>I have previously been running <a rel="noopener" target="_blank" href="https://wiki.netbsd.org/ports/evbarm/">NetBSD/evbarm</a> and <a rel="noopener" target="_blank" href="https://www.openbsd.org/armv7.html">OpenBSD/armv7</a>
on my CubieBoard2, and wrote about it <a rel="noopener" target="_blank" href="https://www.cambus.net/netbsd-on-the-cubieboard2/">here</a> and <a rel="noopener" target="_blank" href="https://www.cambus.net/openbsd-armv7-on-the-cubieboard2/">here</a>.</p>
<p>The <a rel="noopener" target="_blank" href="https://linux-sunxi.org/Cubietech_Cubieboard2">Cubieboard2</a> is an <strong>ARMv7</strong> device which was released in 2013 so
it is quite ancient by now. However, a renewed interest in FreeBSD on my
side prompted me to try running the system on this device.</p>
<p>ARMv7 is a <strong>Tier 2</strong> architecture on FreeBSD, so the system cannot be upgraded
by <strong>freebsd-update</strong> and must be kept up to date by source. On the plus side,
binary packages are available on this platform. For those interested, the
FreeBSD wiki has more information about <a rel="noopener" target="_blank" href="https://wiki.freebsd.org/action/show/arm/Allwinner?action=show&amp;redirect=FreeBSD%2Farm%2FAllwinner">running FreeBSD on Allwinner systems</a>.</p>
<p><img src="/content/2021/03/cubieboard2.jpg" alt="Cubieboard2" title="Cubieboard2" /></p>
<p>Required steps for creating a bootable micro SD card are as follow:
on a FreeBSD machine, we need to install the <a rel="noopener" target="_blank" href="https://www.freshports.org/sysutils/u-boot-cubieboard2/">u-boot-cubieboard2</a> package
and write the image file and the bootloader to the card.</p>
<pre style="background-color:#272822;color:#f8f8f2;"><code><span>pkg install u-boot-cubieboard2
</span><span>dd if=FreeBSD-13.0-RELEASE-arm-armv7-GENERICSD.img of=/dev/da0 bs=1M conv=sync
</span><span>dd if=/usr/local/share/u-boot/u-boot-cubieboard2/u-boot-sunxi-with-spl.bin of=/dev/da0 bs=1k seek=8 conv=sync
</span></code></pre>
<p>The partition will be automatically resized during first boot to span the
whole capacity of the card.</p>
<p>Here is the output of running <em>file</em> on executables:</p>
<pre style="background-color:#272822;color:#f8f8f2;"><code><span>ELF 32-bit LSB executable, ARM, EABI5 version 1 (FreeBSD), dynamically linked, interpreter /libexec/ld-elf.so.1, FreeBSD-style, for FreeBSD 13.0 (1300139), stripped
</span></code></pre>
<p>Here is the result of the <strong>md5 -t</strong> benchmark:</p>
<pre data-lang="sh" style="background-color:#272822;color:#f8f8f2;" class="language-sh "><code class="language-sh" data-lang="sh"><span>MD5 time trial. Digesting 100000 10000-byte blocks ... done
</span><span>Digest = 766a2bb5d24bddae466c572bcabca3ee
</span><span>Time = 13.895305 seconds
</span><span>Speed = 68.632843 MiB/second
</span></code></pre>
<p>And this is the result of the <strong>sha1 -t</strong> benchmark:</p>
<pre data-lang="sh" style="background-color:#272822;color:#f8f8f2;" class="language-sh "><code class="language-sh" data-lang="sh"><span>SHA1 time trial. Digesting 100000 10000-byte blocks ... done
</span><span>Digest = 02522491d7a8253fcab708560acfa84b2fb7ef1c
</span><span>Time = 23.223881 seconds
</span><span>Speed = 41.064381 MiB/second
</span></code></pre>
<p>For the record, OpenSSL speed benchmark results are available
<a href="/files/freebsd/openssl-speed-cubieboard2.txt">here</a>.</p>
<p>Finally, here is a dmesg for reference purposes:</p>
<pre style="background-color:#272822;color:#f8f8f2;"><code><span>Copyright (c) 1992-2021 The FreeBSD Project.
</span><span>Copyright (c) 1979, 1980, 1983, 1986, 1988, 1989, 1991, 1992, 1993, 1994
</span><span>	The Regents of the University of California. All rights reserved.
</span><span>FreeBSD is a registered trademark of The FreeBSD Foundation.
</span><span>FreeBSD 13.0-RELEASE #0 releng/13.0-n244733-ea31abc261f: Fri Apr  9 06:33:09 UTC 2021
</span><span>    root@releng1.nyi.freebsd.org:/usr/obj/usr/src/arm.armv7/sys/GENERIC arm
</span><span>FreeBSD clang version 11.0.1 (git@github.com:llvm/llvm-project.git llvmorg-11.0.1-0-g43ff75f2c3fe)
</span><span>VT: init without driver.
</span><span>No PSCI/SMCCC call function found
</span><span>CPU: ARM Cortex-A7 r0p4 (ECO: 0x00000000)
</span><span>CPU Features: 
</span><span>  Multiprocessing, Thumb2, Security, Virtualization, Generic Timer, VMSAv7,
</span><span>  PXN, LPAE, Coherent Walk
</span><span>Optional instructions: 
</span><span>  SDIV/UDIV, UMULL, SMULL, SIMD(ext)
</span><span>LoUU:2 LoC:3 LoUIS:2 
</span><span>Cache level 1:
</span><span> 32KB/64B 4-way data cache WB Read-Alloc Write-Alloc
</span><span> 32KB/32B 2-way instruction cache Read-Alloc
</span><span>Cache level 2:
</span><span> 256KB/64B 8-way unified cache WB Read-Alloc Write-Alloc
</span><span>real memory  = 1039581184 (991 MB)
</span><span>avail memory = 1002311680 (955 MB)
</span><span>FreeBSD/SMP: Multiprocessor System Detected: 2 CPUs
</span><span>random: unblocking device.
</span><span>random: entropy device external interface
</span><span>WARNING: Device &quot;kbd&quot; is Giant locked and may be deleted before FreeBSD 14.0.
</span><span>kbd0 at kbdmux0
</span><span>WARNING: Device &quot;openfirm&quot; is Giant locked and may be deleted before FreeBSD 14.0.
</span><span>ofwbus0: &lt;Open Firmware Device Tree&gt;
</span><span>aw_ccu0: &lt;Allwinner Clock Control Unit&gt; on ofwbus0
</span><span>clk_fixed0: &lt;Fixed clock&gt; on aw_ccu0
</span><span>clk_fixed1: &lt;Fixed clock&gt; on aw_ccu0
</span><span>clk_fixed2: &lt;Fixed clock&gt; on aw_ccu0
</span><span>clk_fixed3: &lt;Fixed clock&gt; on aw_ccu0
</span><span>simplebus0: &lt;Flattened device tree simple bus&gt; on ofwbus0
</span><span>regfix0: &lt;Fixed Regulator&gt; on ofwbus0
</span><span>regfix1: &lt;Fixed Regulator&gt; on ofwbus0
</span><span>regfix2: &lt;Fixed Regulator&gt; on ofwbus0
</span><span>regfix3: &lt;Fixed Regulator&gt; on ofwbus0
</span><span>regfix4: &lt;Fixed Regulator&gt; on ofwbus0
</span><span>regfix5: &lt;Fixed Regulator&gt; on ofwbus0
</span><span>rtc0: &lt;Allwinner RTC&gt; mem 0x1c20d00-0x1c20d1f irq 39 on simplebus0
</span><span>rtc0: registered as a time-of-day clock, resolution 1.000000s
</span><span>aw_gmacclk0: &lt;Allwinner GMAC Clock&gt; mem 0x1c20164-0x1c20167 on aw_ccu0
</span><span>ccu_a10ng0: &lt;Allwinner A10/A20 Clock Control Unit NG&gt; mem 0x1c20000-0x1c203ff on simplebus0
</span><span>gic0: &lt;ARM Generic Interrupt Controller&gt; mem 0x1c81000-0x1c81fff,0x1c82000-0x1c83fff,0x1c84000-0x1c85fff,0x1c86000-0x1c87fff irq 77 on simplebus0
</span><span>gic0: pn 0x1, arch 0x2, rev 0x1, implementer 0x43b irqs 160
</span><span>aw_nmi0: &lt;Allwinner NMI Controller&gt; mem 0x1c00030-0x1c0003b irq 6 on simplebus0
</span><span>gpio0: &lt;Allwinner GPIO/Pinmux controller&gt; mem 0x1c20800-0x1c20bff irq 31 on simplebus0
</span><span>gpiobus0: &lt;OFW GPIO bus&gt; on gpio0
</span><span>iichb0: &lt;Allwinner Integrated I2C Bus Controller&gt; mem 0x1c2ac00-0x1c2afff irq 59 on simplebus0
</span><span>iicbus0: &lt;OFW I2C bus&gt; on iichb0
</span><span>axp2xx_pmu0: &lt;X-Powers AXP209 Power Management Unit&gt; at addr 0x68 irq 82 on iicbus0
</span><span>gpiobus1: &lt;OFW GPIO bus&gt; on axp2xx_pmu0
</span><span>iichb1: &lt;Allwinner Integrated I2C Bus Controller&gt; mem 0x1c2b000-0x1c2b3ff irq 60 on simplebus0
</span><span>iicbus1: &lt;OFW I2C bus&gt; on iichb1
</span><span>generic_timer0: &lt;ARMv7 Generic Timer&gt; irq 0,1,2,3 on ofwbus0
</span><span>Timecounter &quot;ARM MPCore Timecounter&quot; frequency 24000000 Hz quality 1000
</span><span>Event timer &quot;ARM MPCore Eventtimer&quot; frequency 24000000 Hz quality 1000
</span><span>aw_sid0: &lt;Allwinner Secure ID Controller&gt; mem 0x1c23800-0x1c239ff on simplebus0
</span><span>awusbphy0: &lt;Allwinner USB PHY&gt; mem 0x1c13400-0x1c1340f,0x1c14800-0x1c14803,0x1c1c800-0x1c1c803 on simplebus0
</span><span>cpulist0: &lt;Open Firmware CPU Group&gt; on ofwbus0
</span><span>cpu0: &lt;Open Firmware CPU&gt; on cpulist0
</span><span>cpufreq_dt0: &lt;Generic cpufreq driver&gt; on cpu0
</span><span>cpu1: &lt;Open Firmware CPU&gt; on cpulist0
</span><span>pmu0: &lt;Performance Monitoring Unit&gt; irq 4,5 on ofwbus0
</span><span>a10dmac0: &lt;Allwinner DMA controller&gt; mem 0x1c02000-0x1c02fff irq 7 on simplebus0
</span><span>aw_mmc0: &lt;Allwinner Integrated MMC/SD controller&gt; mem 0x1c0f000-0x1c0ffff irq 16 on simplebus0
</span><span>musbotg0: &lt;Allwinner USB DRD&gt; mem 0x1c13000-0x1c133ff irq 20 on simplebus0
</span><span>musbotg0: setting phy mode 3
</span><span>usbus0: Dynamic FIFO sizing detected, assuming 16Kbytes of FIFO RAM
</span><span>usbus0 on musbotg0
</span><span>ehci0: &lt;Generic EHCI Controller&gt; mem 0x1c14000-0x1c140ff irq 21 on simplebus0
</span><span>usbus1: EHCI version 1.0
</span><span>usbus1 on ehci0
</span><span>ohci0: &lt;Generic OHCI Controller&gt; mem 0x1c14400-0x1c144ff irq 22 on simplebus0
</span><span>usbus2 on ohci0
</span><span>ahci0: &lt;Allwinner Integrated AHCI controller&gt; mem 0x1c18000-0x1c18fff irq 26 on simplebus0
</span><span>ahci0: AHCI v1.10 with 1 3Gbps ports, Port Multiplier not supported
</span><span>ahci0: quirks=0x2&lt;NOPMP&gt;
</span><span>ehci1: &lt;Generic EHCI Controller&gt; mem 0x1c1c000-0x1c1c0ff irq 27 on simplebus0
</span><span>usbus3: EHCI version 1.0
</span><span>usbus3 on ehci1
</span><span>ohci1: &lt;Generic OHCI Controller&gt; mem 0x1c1c400-0x1c1c4ff irq 28 on simplebus0
</span><span>usbus4 on ohci1
</span><span>gpioc0: &lt;GPIO controller&gt; on gpio0
</span><span>aw_wdog0: &lt;Allwinner A10 Watchdog&gt; mem 0x1c20c90-0x1c20c9f irq 38 on simplebus0
</span><span>aw_ir0: &lt;Allwinner CIR controller&gt; mem 0x1c21800-0x1c2183f irq 41 on simplebus0
</span><span>pcm0: &lt;Allwinner Audio Codec&gt; mem 0x1c22c00-0x1c22c3f irq 46 on simplebus0
</span><span>pcm0: cannot find codec clock
</span><span>device_attach: pcm0 attach returned 6
</span><span>aw_ts0: &lt;Allwinner Touch Screen controller&gt; mem 0x1c25000-0x1c250ff irq 48 on simplebus0
</span><span>uart0: &lt;16750 or compatible&gt; mem 0x1c28000-0x1c283ff irq 49 on simplebus0
</span><span>uart0: console (115384,n,8,1)
</span><span>gpioc1: &lt;GPIO controller&gt; on axp2xx_pmu0
</span><span>iic0: &lt;I2C generic I/O&gt; on iicbus0
</span><span>iic1: &lt;I2C generic I/O&gt; on iicbus1
</span><span>dwc0: &lt;A20 Gigabit Ethernet Controller&gt; mem 0x1c50000-0x1c5ffff irq 72 on simplebus0
</span><span>miibus0: &lt;MII bus&gt; on dwc0
</span><span>rlphy0: &lt;RTL8201L 10/100 media interface&gt; PHY 1 on miibus0
</span><span>rlphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
</span><span>dwc0: Ethernet address: 02:0a:09:03:27:08
</span><span>gpioled0: &lt;GPIO LEDs&gt; on ofwbus0
</span><span>cryptosoft0: &lt;software crypto&gt;
</span><span>Timecounters tick every 1.000 msec
</span><span>usbus0: 480Mbps High Speed USB v2.0
</span><span>usbus1: 480Mbps High Speed USB v2.0
</span><span>usbus2: 12Mbps Full Speed USB v1.0
</span><span>usbus3: 480Mbps High Speed USB v2.0
</span><span>usbus4: 12Mbps Full Speed USB v1.0
</span><span>Release APs
</span><span>ugen0.1: &lt;Mentor Graphics OTG Root HUB&gt; at usbus0
</span><span>Trying to mount root from ufs:/dev/ufs/rootfs [rw]...
</span><span>uhub0Root mount waiting for: on usbus0
</span><span> usbus0uhub0: &lt;Mentor Graphics OTG Root HUB, class 9/0, rev 2.00/1.00, addr 1&gt; on usbus0
</span><span> usbus1ugen1.1: &lt;Generic EHCI root HUB&gt; at usbus1
</span><span> usbus2uhub1 usbus3 on usbus1
</span><span> usbus4uhub1: &lt;Generic EHCI root HUB, class 9/0, rev 2.00/1.00, addr 1&gt; on usbus1
</span><span> CAMugen2.1: &lt;Generic OHCI root HUB&gt; at usbus2
</span><span>
</span><span>uhub2 on usbus2
</span><span>uhub2: &lt;Generic OHCI root HUB, class 9/0, rev 1.00/1.00, addr 1&gt; on usbus2
</span><span>ugen4.1: &lt;Generic OHCI root HUB&gt; at usbus4
</span><span>ugen3.1: &lt;Generic EHCI root HUB&gt; at usbus3
</span><span>uhub3 on usbus4
</span><span>uhub4 on usbus3
</span><span>uhub3: &lt;Generic OHCI root HUB, class 9/0, rev 1.00/1.00, addr 1&gt; on usbus4
</span><span>uhub4: &lt;Generic EHCI root HUB, class 9/0, rev 2.00/1.00, addr 1&gt; on usbus3
</span><span>mmc0: &lt;MMC/SD bus&gt; on aw_mmc0
</span><span>mmcsd0: 249GB &lt;SDHC SD256 6.1 SN 35B0016A MFG 09/2020 by 159 TI&gt; at mmc0 50.0MHz/4bit/32768-block
</span><span>mmc0: Failed to set VCCQ for card at relative address 20552
</span><span>uhub2: 1 port with 1 removable, self powered
</span><span>uhub3: 1 port with 1 removable, self powered
</span><span>uhub0: 1 port with 1 removable, self powered
</span><span>uhub1: 1 port with 1 removable, self powered
</span><span>uhub4: 1 port with 1 removable, self powered
</span><span>mountroot: waiting for device /dev/ufs/rootfs...
</span><span>lo0: link state changed to UP
</span><span>dwc0: link state changed to UP
</span></code></pre>
